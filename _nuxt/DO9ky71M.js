import{c as O,s as R,u as T,b as D,_ as U,T as P,a as F}from"./mdYnEB4F.js";import{g as $,s as k,y as H,k as C,z as K,o as f,c as _,n as v,a as c,A as V,B as S,t as x,F as L,v as A,d as W,_ as b,x as M,b as h,w as B,m as j,C as z,D as N,l as J,E as q}from"./yOBcruEM.js";import"./CodHl1kJ.js";const G=[{id:"white",name:"Белый"},{id:"black",name:"Черный"},{id:"blue",name:"Синий"},{id:"red",name:"Красный"},{id:"green",name:"Зеленый"},{id:"yellow",name:"Желтый"}],Q=["aria-expanded"],X=["aria-selected","onClick","onKeydown"],Y=$({__name:"Dropdown",props:{items:{},currentItem:{default:""},externalInvalid:{type:Boolean,default:!1}},emits:["inputEvent","changeItem","validation"],setup(p,{emit:s}){const n=p,i=k(!1),r=k(n.currentItem),u=s;H(()=>n.currentItem,e=>{r.value=e});const g=C(()=>{const e=n.items.find(t=>t.id===r.value);return e?e.name:"Select"}),y=C(()=>r.value),m=()=>{i.value=!i.value},o=()=>{i.value=!1},a=e=>{r.value=e.id,u("inputEvent",e.id),u("changeItem",e.id),o()},l={mounted(e,t){const d=I=>{e===I.target||e.contains(I.target)||t.value(I)};e.clickOutsideHandler=d,document.body.addEventListener("click",d)},unmounted(e){const t=e.clickOutsideHandler;t&&document.body.removeEventListener("click",t)}};return(e,t)=>K((f(),_("div",{class:v(e.$style.wrap)},[c("button",{class:v([e.$style.dropdown,n.externalInvalid?e.$style.error:""]),onClick:m,onKeydown:S(o,["esc"]),"aria-haspopup":"listbox","aria-expanded":i.value},[c("span",null,x(g.value),1),(f(),_("svg",{class:v(i.value?[e.$style.chevron,e.$style.rotated]:e.$style.chevron),width:"16",height:"16",viewBox:"0 0 16 16"},[...t[0]||(t[0]=[c("path",{d:"M4 6L8 10L12 6",stroke:"currentColor",fill:"none"},null,-1)])],2))],42,Q),i.value?(f(),_("div",{key:0,class:v(e.$style.menu),role:"listbox","aria-labelledby":"dropdown-label"},[(f(!0),_(L,null,A(p.items,(d,I)=>(f(),_("div",{key:I,role:"option","aria-selected":d.id===y.value,class:v(d.id===y.value?[e.$style.option,e.$style["is-selected"]]:e.$style.option),onClick:w=>a(d),onKeydown:[S(w=>a(d),["enter"]),S(w=>a(d),["space"])],tabindex:"0"},[c("span",{class:v(e.$style["option-content"])},[W(x(d.name)+" ",1),d.id===y.value?(f(),_("svg",{key:0,class:v(e.$style.checkmark),width:"16",height:"16",viewBox:"0 0 16 16",fill:"none"},[...t[1]||(t[1]=[c("path",{d:"M13.3334 4L6.00008 11.3333L2.66675 8",stroke:"#ff8800","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])],2)):V("",!0)],2)],42,X))),128))],2)):V("",!0)],2)),[[l,o]])}}),Z="_wrap_1c0xe_1",ee="_dropdown_1c0xe_9",te="_chevron_1c0xe_33",ne="_rotated_1c0xe_38",oe="_menu_1c0xe_42",ae="_checkmark_1c0xe_64",le="_option_1c0xe_57",se="_error_1c0xe_82",ie={wrap:Z,dropdown:ee,chevron:te,rotated:ne,menu:oe,"option-content":"_option-content_1c0xe_57",checkmark:ae,option:le,error:se,"is-selected":"_is-selected_1c0xe_87"},re={$style:ie},ce=b(Y,[["__cssModules",re]]),ue=["value","placeholder"],de=$({__name:"Input",props:{modelValue:{type:[String,Number],default:""},type:{type:String,validator:p=>["count","price"].includes(p),default:"count"},externalInvalid:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(p,{emit:s}){const n=p,i=s,r=k(null),u=C(()=>!n.modelValue&&n.modelValue!==0&&n.modelValue!=="0"?"":String(n.modelValue)),g=C(()=>n.type==="count"?"0":"0.00"),y=o=>{let l=o.target.value;if(l=l.replace(/[^\d.]/g,""),(l.match(/\./g)||[]).length>1){const t=l.indexOf(".");l=l.substring(0,t+1)+l.substring(t+1).replace(/\./g,"")}if(l.includes(".")){const t=l.split(".");t[1]&&t[1].length>2&&(l=t[0]+"."+t[1].substring(0,2))}i("update:modelValue",l),M(()=>{r.value&&(r.value.value=l)})},m=()=>{i("update:modelValue",""),M(()=>{r.value&&r.value.focus()})};return(o,a)=>(f(),_("div",{class:v([o.$style.customInputWrapper,n.externalInvalid?o.$style.invalid:""])},[c("input",{ref_key:"inputRef",ref:r,type:"text",class:v(o.$style.customInput),value:u.value,placeholder:g.value,onInput:y},null,42,ue),u.value?(f(),_("button",{key:0,class:v(o.$style.clearButton),onClick:m,type:"button"},[...a[0]||(a[0]=[c("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none"},[c("path",{d:"M15 1L1 15M1 1L15 15",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1)])],2)):V("",!0)],2))}}),pe="_customInputWrapper_1lnk0_1",me="_invalid_1lnk0_19",ve="_customInput_1lnk0_1",fe="_clearButton_1lnk0_42",_e={customInputWrapper:pe,invalid:me,customInput:ve,clearButton:fe},ye={$style:_e},E=b(de,[["__cssModules",ye]]),ge=$({__name:"TableData",props:{products:{},validationErrors:{default:()=>[]}},emits:["update:products"],setup(p,{emit:s}){const n=p,i=s,r=k({}),u=(o,a)=>n.validationErrors.some(l=>l.productId===o&&l.field===a),g=(o,a)=>{a===""||a==="."?delete r.value[o]:r.value[o]=a;const l=n.products.map(e=>e.id===o?a===""||a==="."?{...e,count:null}:a.includes(".")?{...e,count:NaN}:{...e,count:parseInt(a)||0}:e);i("update:products",l)},y=(o,a)=>{const l=n.products.map(e=>e.id===o?{...e,price:a===""?null:parseFloat(a)||0}:e);i("update:products",l)},m=(o,a)=>{const l=n.products.map(e=>e.id===o?{...e,color:a}:e);i("update:products",l)};return(o,a)=>{const l=O;return f(),_("table",{class:v([o.common.table,o.local.table])},[a[0]||(a[0]=c("thead",null,[c("tr",null,[c("th",null,"Название"),c("th",null,"Количество"),c("th",null,"Цена"),c("th",null,"Цвет")])],-1)),c("tbody",null,[(f(!0),_(L,null,A(p.products,e=>(f(),_("tr",{key:e.id},[c("td",null,x(e.name),1),c("td",null,[h(E,{modelValue:r.value[e.id]!==void 0?r.value[e.id]:e.count===null||e.count===0||isNaN(e.count)?"":e.count.toString(),"onUpdate:modelValue":t=>g(e.id,t),type:"count",externalInvalid:u(e.id,"count")},null,8,["modelValue","onUpdate:modelValue","externalInvalid"])]),c("td",null,[h(E,{modelValue:e.price===null||e.price===0?"":e.price.toString(),"onUpdate:modelValue":t=>y(e.id,t),type:"price",externalInvalid:u(e.id,"price")},null,8,["modelValue","onUpdate:modelValue","externalInvalid"])]),c("td",null,[h(l,null,{default:B(()=>[h(ce,{items:j(G),currentItem:e.color,onChangeItem:t=>m(e.id,t),externalInvalid:u(e.id,"color")},null,8,["items","currentItem","onChangeItem","externalInvalid"])]),_:2},1024)])]))),128))])],2)}}}),he="_table_d4k9s_1",Ie={table:he},ke={common:R,local:Ie},$e=Object.assign(b(ge,[["__cssModules",ke]]),{__name:"ContentTableContainerTableData"}),be=$({__name:"SaveButton",props:{onClick:{type:Function}},setup(p){const s=p;return(n,i)=>(f(),_("button",{class:v(n.$style.btnSave),onClick:i[0]||(i[0]=(...r)=>s.onClick&&s.onClick(...r))},"Сохранить",2))}}),we="_btnSave_3cr6r_1",Ce={btnSave:we},Se={$style:Ce},Ve=b(be,[["__cssModules",Se]]);function xe(p){const s=[];return p.forEach(n=>{n.count===null||n.count===void 0||n.count===0||isNaN(n.count)?s.push({productId:n.id,field:"count"}):typeof n.count=="number"&&n.count%1!==0&&s.push({productId:n.id,field:"count"}),(n.price===null||n.price===void 0||n.price===0)&&s.push({productId:n.id,field:"price"}),(!n.color||n.color==="Select"||n.color==="")&&s.push({productId:n.id,field:"color"})}),{isValid:s.length===0,errors:s}}const Be=$({__name:"dataView",props:{id:{}},setup(p){const s=p,n=q(),i=T(),r=k([]),u=k([]),{updatePresendStorage:g}=F();z(async()=>{if(typeof window<"u"){const t=localStorage.getItem(`application_${s.id}`);if(t)try{const d=JSON.parse(t);if(Array.isArray(d)&&d.length>0){u.value=d;return}}catch{}}let m=i.getCurrentApplication();if(!m){const t=N(),{data:d}=await D(`${t.app.baseURL}api/table-data`,{default:()=>[]},"$r0gqiC4M95");m=(d.value||[]).find(w=>String(w.id)===String(s.id))??null}const o=m?.productsID||[];if(o.length===0){u.value=[];return}const a=N(),{data:l}=await D(`${a.app.baseURL}api/products`,{key:`products-${s.id}`,default:()=>[]},"$egU8tzc0HH"),e=l.value.filter(t=>o.includes(t.id)).map(t=>({id:t.id,name:t.name,price:t.price,count:t.count,color:t.color}));u.value=e,typeof window<"u"&&localStorage.setItem(`application_${s.id}`,JSON.stringify(e)),i.clearCurrentApplication()});const y=()=>{const m=xe(u.value);if(r.value=m.errors,typeof window<"u"&&localStorage.setItem(`application_${s.id}`,JSON.stringify(u.value)),m.isValid){const o=i.getCurrentApplication(),a={id:parseInt(s.id),isPublished:!0,products:u.value,status:o?.status??"draft",createdAt:o?.createdAt??new Date().toISOString()};g(a);try{localStorage.removeItem(`application_${s.id}`)}catch{}n.push("/")}};return(m,o)=>{const a=U;return f(),J(a,null,{default:B(()=>[c("div",{class:v(m.$style.tabContainer)},[h(Ve,{onClick:y})],2),h(P,null,{default:B(()=>[h($e,{products:u.value,"onUpdate:products":o[0]||(o[0]=l=>u.value=l),validationErrors:r.value},null,8,["products","validationErrors"])]),_:1})]),_:1})}}}),De="_tabContainer_n1ij4_1",Me={tabContainer:De},Ne={$style:Me},Oe=b(Be,[["__cssModules",Ne]]);export{Oe as default};
