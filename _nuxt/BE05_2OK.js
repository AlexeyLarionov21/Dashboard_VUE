import{c as L,s as O,u as A,b as T,_ as P,T as R,a as F}from"./CfJj2SUu.js";import{g as $,s as I,y as U,k as w,z as K,o as v,c as _,n as m,a as c,A as S,B as C,t as V,F as N,v as E,d as W,_ as b,x as D,b as g,w as x,m as j,C as H,D as J,l as z,E as q}from"./Bpk4mnb2.js";import"./Di7ps5KK.js";const G=[{id:"white",name:"Белый"},{id:"black",name:"Черный"},{id:"blue",name:"Синий"},{id:"red",name:"Красный"},{id:"green",name:"Зеленый"},{id:"yellow",name:"Желтый"}],Q=["aria-expanded"],X=["aria-selected","onClick","onKeydown"],Y=$({__name:"Dropdown",props:{items:{},currentItem:{default:""},externalInvalid:{type:Boolean,default:!1}},emits:["inputEvent","changeItem","validation"],setup(d,{emit:s}){const t=d,i=I(!1),r=I(t.currentItem),u=s;U(()=>t.currentItem,e=>{r.value=e});const h=w(()=>{const e=t.items.find(n=>n.id===r.value);return e?e.name:"Select"}),y=w(()=>r.value),f=()=>{i.value=!i.value},o=()=>{i.value=!1},a=e=>{r.value=e.id,u("inputEvent",e.id),u("changeItem",e.id),o()},l={mounted(e,n){const p=k=>{e===k.target||e.contains(k.target)||n.value(k)};e.clickOutsideHandler=p,document.body.addEventListener("click",p)},unmounted(e){const n=e.clickOutsideHandler;n&&document.body.removeEventListener("click",n)}};return(e,n)=>K((v(),_("div",{class:m(e.$style.wrap)},[c("button",{class:m([e.$style.dropdown,t.externalInvalid?e.$style.error:""]),onClick:f,onKeydown:C(o,["esc"]),"aria-haspopup":"listbox","aria-expanded":i.value},[c("span",null,V(h.value),1),(v(),_("svg",{class:m(i.value?[e.$style.chevron,e.$style.rotated]:e.$style.chevron),width:"16",height:"16",viewBox:"0 0 16 16"},[...n[0]||(n[0]=[c("path",{d:"M4 6L8 10L12 6",stroke:"currentColor",fill:"none"},null,-1)])],2))],42,Q),i.value?(v(),_("div",{key:0,class:m(e.$style.menu),role:"listbox","aria-labelledby":"dropdown-label"},[(v(!0),_(N,null,E(d.items,(p,k)=>(v(),_("div",{key:k,role:"option","aria-selected":p.id===y.value,class:m(p.id===y.value?[e.$style.option,e.$style["is-selected"]]:e.$style.option),onClick:B=>a(p),onKeydown:[C(B=>a(p),["enter"]),C(B=>a(p),["space"])],tabindex:"0"},[c("span",{class:m(e.$style["option-content"])},[W(V(p.name)+" ",1),p.id===y.value?(v(),_("svg",{key:0,class:m(e.$style.checkmark),width:"16",height:"16",viewBox:"0 0 16 16",fill:"none"},[...n[1]||(n[1]=[c("path",{d:"M13.3334 4L6.00008 11.3333L2.66675 8",stroke:"#ff8800","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])],2)):S("",!0)],2)],42,X))),128))],2)):S("",!0)],2)),[[l,o]])}}),Z="_wrap_1c0xe_1",ee="_dropdown_1c0xe_9",te="_chevron_1c0xe_33",ne="_rotated_1c0xe_38",oe="_menu_1c0xe_42",ae="_checkmark_1c0xe_64",le="_option_1c0xe_57",se="_error_1c0xe_82",ie={wrap:Z,dropdown:ee,chevron:te,rotated:ne,menu:oe,"option-content":"_option-content_1c0xe_57",checkmark:ae,option:le,error:se,"is-selected":"_is-selected_1c0xe_87"},re={$style:ie},ce=b(Y,[["__cssModules",re]]),ue=["value","placeholder"],de=$({__name:"Input",props:{modelValue:{type:[String,Number],default:""},type:{type:String,validator:d=>["count","price"].includes(d),default:"count"},externalInvalid:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(d,{emit:s}){const t=d,i=s,r=I(null),u=w(()=>!t.modelValue&&t.modelValue!==0&&t.modelValue!=="0"?"":String(t.modelValue)),h=w(()=>t.type==="count"?"0":"0.00"),y=o=>{let l=o.target.value;if(l=l.replace(/[^\d.]/g,""),(l.match(/\./g)||[]).length>1){const n=l.indexOf(".");l=l.substring(0,n+1)+l.substring(n+1).replace(/\./g,"")}if(l.includes(".")){const n=l.split(".");n[1]&&n[1].length>2&&(l=n[0]+"."+n[1].substring(0,2))}i("update:modelValue",l),D(()=>{r.value&&(r.value.value=l)})},f=()=>{i("update:modelValue",""),D(()=>{r.value&&r.value.focus()})};return(o,a)=>(v(),_("div",{class:m([o.$style.customInputWrapper,t.externalInvalid?o.$style.invalid:""])},[c("input",{ref_key:"inputRef",ref:r,type:"text",class:m(o.$style.customInput),value:u.value,placeholder:h.value,onInput:y},null,42,ue),u.value?(v(),_("button",{key:0,class:m(o.$style.clearButton),onClick:f,type:"button"},[...a[0]||(a[0]=[c("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none"},[c("path",{d:"M15 1L1 15M1 1L15 15",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1)])],2)):S("",!0)],2))}}),pe="_customInputWrapper_1lnk0_1",me="_invalid_1lnk0_19",ve="_customInput_1lnk0_1",_e="_clearButton_1lnk0_42",fe={customInputWrapper:pe,invalid:me,customInput:ve,clearButton:_e},ye={$style:fe},M=b(de,[["__cssModules",ye]]),he=$({__name:"TableData",props:{products:{},validationErrors:{default:()=>[]}},emits:["update:products"],setup(d,{emit:s}){const t=d,i=s,r=I({}),u=(o,a)=>t.validationErrors.some(l=>l.productId===o&&l.field===a),h=(o,a)=>{a===""||a==="."?delete r.value[o]:r.value[o]=a;const l=t.products.map(e=>e.id===o?a===""||a==="."?{...e,count:null}:a.includes(".")?{...e,count:NaN}:{...e,count:parseInt(a)||0}:e);i("update:products",l)},y=(o,a)=>{const l=t.products.map(e=>e.id===o?{...e,price:a===""?null:parseFloat(a)||0}:e);i("update:products",l)},f=(o,a)=>{const l=t.products.map(e=>e.id===o?{...e,color:a}:e);i("update:products",l)};return(o,a)=>{const l=L;return v(),_("table",{class:m([o.common.table,o.local.table])},[a[0]||(a[0]=c("thead",null,[c("tr",null,[c("th",null,"Название"),c("th",null,"Количество"),c("th",null,"Цена"),c("th",null,"Цвет")])],-1)),c("tbody",null,[(v(!0),_(N,null,E(d.products,e=>(v(),_("tr",{key:e.id},[c("td",null,V(e.name),1),c("td",null,[g(M,{modelValue:r.value[e.id]!==void 0?r.value[e.id]:e.count===null||e.count===0||isNaN(e.count)?"":e.count.toString(),"onUpdate:modelValue":n=>h(e.id,n),type:"count",externalInvalid:u(e.id,"count")},null,8,["modelValue","onUpdate:modelValue","externalInvalid"])]),c("td",null,[g(M,{modelValue:e.price===null||e.price===0?"":e.price.toString(),"onUpdate:modelValue":n=>y(e.id,n),type:"price",externalInvalid:u(e.id,"price")},null,8,["modelValue","onUpdate:modelValue","externalInvalid"])]),c("td",null,[g(l,null,{default:x(()=>[g(ce,{items:j(G),currentItem:e.color,onChangeItem:n=>f(e.id,n),externalInvalid:u(e.id,"color")},null,8,["items","currentItem","onChangeItem","externalInvalid"])]),_:2},1024)])]))),128))])],2)}}}),ge="_table_d4k9s_1",Ie={table:ge},ke={common:O,local:Ie},$e=Object.assign(b(he,[["__cssModules",ke]]),{__name:"ContentTableContainerTableData"}),be=$({__name:"SaveButton",props:{onClick:{type:Function}},setup(d){const s=d;return(t,i)=>(v(),_("button",{class:m(t.$style.btnSave),onClick:i[0]||(i[0]=(...r)=>s.onClick&&s.onClick(...r))},"Сохранить",2))}}),we="_btnSave_3cr6r_1",Ce={btnSave:we},Se={$style:Ce},Ve=b(be,[["__cssModules",Se]]);function xe(d){const s=[];return d.forEach(t=>{t.count===null||t.count===void 0||t.count===0||isNaN(t.count)?s.push({productId:t.id,field:"count"}):typeof t.count=="number"&&t.count%1!==0&&s.push({productId:t.id,field:"count"}),(t.price===null||t.price===void 0||t.price===0)&&s.push({productId:t.id,field:"price"}),(!t.color||t.color==="Select"||t.color==="")&&s.push({productId:t.id,field:"color"})}),{isValid:s.length===0,errors:s}}const Be=$({__name:"dataView",props:{id:{}},setup(d){const s=d,t=q(),i=A(),r=I([]),u=I([]),{updatePresendStorage:h}=F();H(async()=>{if(typeof window<"u"){const n=localStorage.getItem(`application_${s.id}`);if(n)try{const p=JSON.parse(n);if(Array.isArray(p)&&p.length>0){u.value=p;return}}catch{}}const o=i.getCurrentApplication()?.productsID||[];if(o.length===0){u.value=[];return}const a=J(),{data:l}=await T(`${a.app.baseURL}api/products`,{key:`products-${s.id}`,default:()=>[]},"$r0gqiC4M95"),e=l.value.filter(n=>o.includes(n.id)).map(n=>({id:n.id,name:n.name,price:n.price,count:n.count,color:n.color}));u.value=e,typeof window<"u"&&localStorage.setItem(`application_${s.id}`,JSON.stringify(e)),i.clearCurrentApplication()});const y=()=>{const f=xe(u.value);if(r.value=f.errors,typeof window<"u"&&localStorage.setItem(`application_${s.id}`,JSON.stringify(u.value)),f.isValid){const o=i.getCurrentApplication(),a={id:parseInt(s.id),isPublished:!0,products:u.value,status:o?.status??"draft",createdAt:o?.createdAt??new Date().toISOString()};h(a);try{localStorage.removeItem(`application_${s.id}`)}catch{}t.push("/")}};return(f,o)=>{const a=P;return v(),z(a,null,{default:x(()=>[c("div",{class:m(f.$style.tabContainer)},[g(Ve,{onClick:y})],2),g(R,null,{default:x(()=>[g($e,{products:u.value,"onUpdate:products":o[0]||(o[0]=l=>u.value=l),validationErrors:r.value},null,8,["products","validationErrors"])]),_:1})]),_:1})}}}),De="_tabContainer_n1ij4_1",Me={tabContainer:De},Ne={$style:Me},Ae=b(Be,[["__cssModules",Ne]]);export{Ae as default};
