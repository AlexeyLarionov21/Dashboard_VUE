import{u as T,a as B,b as P,s as M,_ as R,T as j}from"./gykoPF3s.js";import{g as b,c,o as r,n as u,r as D,d as F,t as d,_ as p,p as L,q as z,s as N,k as V,a as e,m as y,F as O,v as Q,b as _,x as U,y as q,l as E,w as h}from"./Dm_KCCgg.js";import"./CCkGues3.js";const G=b({__name:"label",props:{variant:{default:"draft"}},setup(a){const n={draft:"Активна"};return(s,i)=>(r(),c("span",{class:u([s.$style.label,s.$style[a.variant]])},[D(s.$slots,"default",{},()=>[F(d(n[a.variant]),1)])],2))}}),Y="_label_xgtno_1",H="_draft_xgtno_15",I="_sent_xgtno_20",J={label:Y,draft:H,sent:I},K={$style:J},W=p(G,[["__cssModules",K]]),X=b({__name:"Button",props:{label:{},variant:{default:"edit"},isSend:{type:Boolean},onClick:{}},setup(a){return(n,s)=>(r(),c("button",{class:u([n.$style.button,n.$style[a.variant]]),onClick:s[0]||(s[0]=i=>a.onClick?.())},d(a.label),3))}}),Z="_button_116bj_1",tt="_edit_116bj_13",et="_presend_116bj_22",nt={button:Z,edit:tt,presend:et},st={$style:nt},at=p(X,[["__cssModules",st]]),lt={key:0},ot=b({__name:"Table",async setup(a){let n,s;const{getPresendApplications:i,removeFromPresend:$}=B(),v=L(),C=T(),g=U(),{data:m,pending:k,refresh:_t}=([n,s]=z(()=>P(`${g.app.baseURL}api/table-data`,{default:()=>[]},"$7G96YdQnvQ")),n=await n,s(),n),f=N(i()),A=V(()=>m.value.map(t=>f.value[t.id]?{...t,isPublished:!0}:t)),w=async t=>{t.isPublished?(await x(t),console.log("отправка заявки",t.id)):(C.setCurrentApplication(t),await q(),await v.push(`/edit?id=${t.id}`))},x=async t=>{try{const l=await $fetch("/api/send",{method:"POST"});$(t.id),f.value=i(),alert("Заявка отправлена"),m.value=(m.value||[]).filter(o=>o.id!==t.id)}catch(l){alert("ошибка"),console.error("ошибка отправки",l)}},S=t=>new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});return(t,l)=>(r(),c("table",{class:u([t.common.table,t.local.table])},[l[1]||(l[1]=e("thead",null,[e("tr",null,[e("th",null,"Номер"),e("th",null,"Статус"),e("th",null,"Результат"),e("th",null,"Дата"),e("th",null,"Действие")])],-1)),e("tbody",null,[y(k)?(r(),c("tr",lt,[...l[0]||(l[0]=[e("td",{colspan:"5"},[e("h3",null,"Загрузка..")],-1)])])):(r(!0),c(O,{key:1},Q(y(A),o=>(r(),c("tr",{key:o.id},[e("td",null,d(o.id),1),e("td",null,[_(W,{variant:"draft"})]),e("td",{class:u(t.local.tdResult)},"В обработке",2),e("td",null,d(S(o.createdAt)),1),e("td",null,[_(at,{variant:o.isPublished?"presend":"edit",label:o.isPublished?"Отправить":"Редактировать",onClick:()=>w(o)},null,8,["variant","label","onClick"])])]))),128))])],2))}}),rt="_tdResult_izthi_1",it="_table_izthi_5",ct={tdResult:rt,table:it},ut={common:M,local:ct},dt=Object.assign(p(ot,[["__cssModules",ut]]),{__name:"ContentTableContainerTable"}),ft=b({__name:"index",setup(a){return(n,s)=>{const i=R;return r(),E(i,null,{default:h(()=>[_(j,null,{default:h(()=>[_(dt)]),_:1})]),_:1})}}});export{ft as default};
