import{u as S,a as T,b as B,s as P,_ as M,T as R}from"./CfJj2SUu.js";import{g as b,c as i,o as r,n as u,r as j,d as D,t as d,_ as p,p as F,q as z,s as L,k as N,a as e,m as h,F as V,v as O,b as _,x as Q,l as q,w as y}from"./Bpk4mnb2.js";import"./Di7ps5KK.js";const E=b({__name:"label",props:{variant:{default:"draft"}},setup(a){const n={draft:"Активна"};return(s,c)=>(r(),i("span",{class:u([s.$style.label,s.$style[a.variant]])},[j(s.$slots,"default",{},()=>[D(d(n[a.variant]),1)])],2))}}),G="_label_xgtno_1",U="_draft_xgtno_15",Y="_sent_xgtno_20",H={label:G,draft:U,sent:Y},I={$style:H},J=p(E,[["__cssModules",I]]),K=b({__name:"Button",props:{label:{},variant:{default:"edit"},isSend:{type:Boolean},onClick:{}},setup(a){return(n,s)=>(r(),i("button",{class:u([n.$style.button,n.$style[a.variant]]),onClick:s[0]||(s[0]=c=>a.onClick?.())},d(a.label),3))}}),W="_button_116bj_1",X="_edit_116bj_13",Z="_presend_116bj_22",tt={button:W,edit:X,presend:Z},et={$style:tt},nt=p(K,[["__cssModules",et]]),st={key:0},at=b({__name:"Table",async setup(a){let n,s;const{getPresendApplications:c,removeFromPresend:$}=T(),v=F(),C=S(),{data:m,pending:k,refresh:ut}=([n,s]=z(()=>B("/api/table-data",{default:()=>[]},"$7G96YdQnvQ")),n=await n,s(),n),f=L(c()),g=N(()=>m.value.map(t=>f.value[t.id]?{...t,isPublished:!0}:t)),A=async t=>{t.isPublished?(await w(t),console.log("отправка заявки",t.id)):(C.setCurrentApplication(t),await Q(),await v.push(`/edit?id=${t.id}`))},w=async t=>{try{const l=await $fetch("/api/send",{method:"POST"});$(t.id),f.value=c(),alert("Заявка отправлена"),m.value=(m.value||[]).filter(o=>o.id!==t.id)}catch(l){alert("ошибка"),console.error("ошибка отправки",l)}},x=t=>new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});return(t,l)=>(r(),i("table",{class:u([t.common.table,t.local.table])},[l[1]||(l[1]=e("thead",null,[e("tr",null,[e("th",null,"Номер"),e("th",null,"Статус"),e("th",null,"Результат"),e("th",null,"Дата"),e("th",null,"Действие")])],-1)),e("tbody",null,[h(k)?(r(),i("tr",st,[...l[0]||(l[0]=[e("td",{colspan:"5"},[e("h3",null,"Загрузка..")],-1)])])):(r(!0),i(V,{key:1},O(h(g),o=>(r(),i("tr",{key:o.id},[e("td",null,d(o.id),1),e("td",null,[_(J,{variant:"draft"})]),e("td",{class:u(t.local.tdResult)},"В обработке",2),e("td",null,d(x(o.createdAt)),1),e("td",null,[_(nt,{variant:o.isPublished?"presend":"edit",label:o.isPublished?"Отправить":"Редактировать",onClick:()=>A(o)},null,8,["variant","label","onClick"])])]))),128))])],2))}}),lt="_tdResult_izthi_1",ot="_table_izthi_5",rt={tdResult:lt,table:ot},ct={common:P,local:rt},it=Object.assign(p(at,[["__cssModules",ct]]),{__name:"ContentTableContainerTable"}),mt=b({__name:"index",setup(a){return(n,s)=>{const c=M;return r(),q(c,null,{default:y(()=>[_(R,null,{default:y(()=>[_(it)]),_:1})]),_:1})}}});export{mt as default};
