import{c as L,s as O,u as T,b as A,_ as P,T as R,a as F}from"./DfaP79Cw.js";import{g as $,s as I,y as U,k as w,z as K,o as m,c as v,n as p,a as c,A as S,B as C,t as V,F as N,v as E,d as W,_ as b,x as D,b as g,w as x,m as j,C as H,D as J,l as z,E as q}from"./CjZTJ5AR.js";import"./B-XC6-s1.js";const G=[{id:"white",name:"Белый"},{id:"black",name:"Черный"},{id:"blue",name:"Синий"},{id:"red",name:"Красный"},{id:"green",name:"Зеленый"},{id:"yellow",name:"Желтый"}],Q=["aria-expanded"],X=["aria-selected","onClick","onKeydown"],Y=$({__name:"Dropdown",props:{items:{},currentItem:{default:""},externalInvalid:{type:Boolean,default:!1}},emits:["inputEvent","changeItem","validation"],setup(d,{emit:s}){const t=d,i=I(!1),r=I(t.currentItem),u=s;U(()=>t.currentItem,e=>{r.value=e});const h=w(()=>{const e=t.items.find(n=>n.id===r.value);return e?e.name:"Select"}),y=w(()=>r.value),_=()=>{i.value=!i.value},o=()=>{i.value=!1},l=e=>{r.value=e.id,u("inputEvent",e.id),u("changeItem",e.id),o()},a={mounted(e,n){const f=k=>{e===k.target||e.contains(k.target)||n.value(k)};e.clickOutsideHandler=f,document.body.addEventListener("click",f)},unmounted(e){const n=e.clickOutsideHandler;n&&document.body.removeEventListener("click",n)}};return(e,n)=>K((m(),v("div",{class:p(e.$style.wrap)},[c("button",{class:p([e.$style.dropdown,t.externalInvalid?e.$style.error:""]),onClick:_,onKeydown:C(o,["esc"]),"aria-haspopup":"listbox","aria-expanded":i.value},[c("span",null,V(h.value),1),(m(),v("svg",{class:p(i.value?[e.$style.chevron,e.$style.rotated]:e.$style.chevron),width:"16",height:"16",viewBox:"0 0 16 16"},[...n[0]||(n[0]=[c("path",{d:"M4 6L8 10L12 6",stroke:"currentColor",fill:"none"},null,-1)])],2))],42,Q),i.value?(m(),v("div",{key:0,class:p(e.$style.menu),role:"listbox","aria-labelledby":"dropdown-label"},[(m(!0),v(N,null,E(d.items,(f,k)=>(m(),v("div",{key:k,role:"option","aria-selected":f.id===y.value,class:p(f.id===y.value?[e.$style.option,e.$style["is-selected"]]:e.$style.option),onClick:B=>l(f),onKeydown:[C(B=>l(f),["enter"]),C(B=>l(f),["space"])],tabindex:"0"},[c("span",{class:p(e.$style["option-content"])},[W(V(f.name)+" ",1),f.id===y.value?(m(),v("svg",{key:0,class:p(e.$style.checkmark),width:"16",height:"16",viewBox:"0 0 16 16",fill:"none"},[...n[1]||(n[1]=[c("path",{d:"M13.3334 4L6.00008 11.3333L2.66675 8",stroke:"#ff8800","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])],2)):S("",!0)],2)],42,X))),128))],2)):S("",!0)],2)),[[a,o]])}}),Z="_wrap_1c0xe_1",ee="_dropdown_1c0xe_9",te="_chevron_1c0xe_33",ne="_rotated_1c0xe_38",oe="_menu_1c0xe_42",le="_checkmark_1c0xe_64",ae="_option_1c0xe_57",se="_error_1c0xe_82",ie={wrap:Z,dropdown:ee,chevron:te,rotated:ne,menu:oe,"option-content":"_option-content_1c0xe_57",checkmark:le,option:ae,error:se,"is-selected":"_is-selected_1c0xe_87"},re={$style:ie},ce=b(Y,[["__cssModules",re]]),ue=["value","placeholder"],de=$({__name:"Input",props:{modelValue:{type:[String,Number],default:""},type:{type:String,validator:d=>["count","price"].includes(d),default:"count"},externalInvalid:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(d,{emit:s}){const t=d,i=s,r=I(null),u=w(()=>!t.modelValue&&t.modelValue!==0&&t.modelValue!=="0"?"":String(t.modelValue)),h=w(()=>t.type==="count"?"0":"0.00"),y=o=>{let a=o.target.value;if(a=a.replace(/[^\d.]/g,""),(a.match(/\./g)||[]).length>1){const n=a.indexOf(".");a=a.substring(0,n+1)+a.substring(n+1).replace(/\./g,"")}if(a.includes(".")){const n=a.split(".");n[1]&&n[1].length>2&&(a=n[0]+"."+n[1].substring(0,2))}i("update:modelValue",a),D(()=>{r.value&&(r.value.value=a)})},_=()=>{i("update:modelValue",""),D(()=>{r.value&&r.value.focus()})};return(o,l)=>(m(),v("div",{class:p([o.$style.customInputWrapper,t.externalInvalid?o.$style.invalid:""])},[c("input",{ref_key:"inputRef",ref:r,type:"text",class:p(o.$style.customInput),value:u.value,placeholder:h.value,onInput:y},null,42,ue),u.value?(m(),v("button",{key:0,class:p(o.$style.clearButton),onClick:_,type:"button"},[...l[0]||(l[0]=[c("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none"},[c("path",{d:"M15 1L1 15M1 1L15 15",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1)])],2)):S("",!0)],2))}}),pe="_customInputWrapper_1lnk0_1",me="_invalid_1lnk0_19",ve="_customInput_1lnk0_1",_e="_clearButton_1lnk0_42",fe={customInputWrapper:pe,invalid:me,customInput:ve,clearButton:_e},ye={$style:fe},M=b(de,[["__cssModules",ye]]),he=$({__name:"TableData",props:{products:{},validationErrors:{default:()=>[]}},emits:["update:products"],setup(d,{emit:s}){const t=d,i=s,r=I({}),u=(o,l)=>t.validationErrors.some(a=>a.productId===o&&a.field===l),h=(o,l)=>{l===""||l==="."?delete r.value[o]:r.value[o]=l;const a=t.products.map(e=>e.id===o?l===""||l==="."?{...e,count:null}:l.includes(".")?{...e,count:NaN}:{...e,count:parseInt(l)||0}:e);i("update:products",a)},y=(o,l)=>{const a=t.products.map(e=>e.id===o?{...e,price:l===""?null:parseFloat(l)||0}:e);i("update:products",a)},_=(o,l)=>{const a=t.products.map(e=>e.id===o?{...e,color:l}:e);i("update:products",a)};return(o,l)=>{const a=L;return m(),v("table",{class:p([o.common.table,o.local.table])},[l[0]||(l[0]=c("thead",null,[c("tr",null,[c("th",null,"Название"),c("th",null,"Количество"),c("th",null,"Цена"),c("th",null,"Цвет")])],-1)),c("tbody",null,[(m(!0),v(N,null,E(d.products,e=>(m(),v("tr",{key:e.id},[c("td",null,V(e.name),1),c("td",null,[g(M,{modelValue:r.value[e.id]!==void 0?r.value[e.id]:e.count===null||e.count===0||isNaN(e.count)?"":e.count.toString(),"onUpdate:modelValue":n=>h(e.id,n),type:"count",externalInvalid:u(e.id,"count")},null,8,["modelValue","onUpdate:modelValue","externalInvalid"])]),c("td",null,[g(M,{modelValue:e.price===null||e.price===0?"":e.price.toString(),"onUpdate:modelValue":n=>y(e.id,n),type:"price",externalInvalid:u(e.id,"price")},null,8,["modelValue","onUpdate:modelValue","externalInvalid"])]),c("td",null,[g(a,null,{default:x(()=>[g(ce,{items:j(G),currentItem:e.color,onChangeItem:n=>_(e.id,n),externalInvalid:u(e.id,"color")},null,8,["items","currentItem","onChangeItem","externalInvalid"])]),_:2},1024)])]))),128))])],2)}}}),ge="_table_d4k9s_1",Ie={table:ge},ke={common:O,local:Ie},$e=Object.assign(b(he,[["__cssModules",ke]]),{__name:"ContentTableContainerTableData"}),be=$({__name:"SaveButton",props:{onClick:{type:Function}},setup(d){const s=d;return(t,i)=>(m(),v("button",{class:p(t.$style.btnSave),onClick:i[0]||(i[0]=(...r)=>s.onClick&&s.onClick(...r))},"Сохранить",2))}}),we="_btnSave_3cr6r_1",Ce={btnSave:we},Se={$style:Ce},Ve=b(be,[["__cssModules",Se]]);function xe(d){const s=[];return d.forEach(t=>{t.count===null||t.count===void 0||t.count===0||isNaN(t.count)?s.push({productId:t.id,field:"count"}):typeof t.count=="number"&&t.count%1!==0&&s.push({productId:t.id,field:"count"}),(t.price===null||t.price===void 0||t.price===0)&&s.push({productId:t.id,field:"price"}),(!t.color||t.color==="Select"||t.color==="")&&s.push({productId:t.id,field:"color"})}),{isValid:s.length===0,errors:s}}const Be=$({__name:"dataView",props:{id:{}},setup(d){const s=d,t=q(),i=T(),r=I([]),u=I([]),{updatePresendStorage:h}=F();H(async()=>{if(typeof window<"u"){const n=localStorage.getItem(`application_${s.id}`);if(n){u.value=JSON.parse(n);return}}const o=i.getCurrentApplication()?.productsID||[];if(o.length===0){u.value=[];return}const l=J(),{data:a}=await A(`${l.app.baseURL}api/products`,{key:`products-${s.id}`,default:()=>[]},"$r0gqiC4M95"),e=a.value.filter(n=>o.includes(n.id)).map(n=>({id:n.id,name:n.name,price:n.price,count:n.count,color:n.color}));u.value=e,typeof window<"u"&&localStorage.setItem(`application_${s.id}`,JSON.stringify(e)),i.clearCurrentApplication()});const y=()=>{const _=xe(u.value);if(r.value=_.errors,typeof window<"u"&&localStorage.setItem(`application_${s.id}`,JSON.stringify(u.value)),_.isValid){const o=i.getCurrentApplication(),l={id:parseInt(s.id),isPublished:!0,products:u.value,status:o?.status??"draft",createdAt:o?.createdAt??new Date().toISOString()};h(l);try{localStorage.removeItem(`application_${s.id}`)}catch{}t.push("/")}};return(_,o)=>{const l=P;return m(),z(l,null,{default:x(()=>[c("div",{class:p(_.$style.tabContainer)},[g(Ve,{onClick:y})],2),g(R,null,{default:x(()=>[g($e,{products:u.value,"onUpdate:products":o[0]||(o[0]=a=>u.value=a),validationErrors:r.value},null,8,["products","validationErrors"])]),_:1})]),_:1})}}}),De="_tabContainer_n1ij4_1",Me={tabContainer:De},Ne={$style:Me},Te=b(Be,[["__cssModules",Ne]]);export{Te as default};
