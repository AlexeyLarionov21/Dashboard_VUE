import{_ as A,s as O,u as L,b as P,c as T,T as R,a as F}from"./CEzST-VG.js";import{g as $,s as k,y as U,k as w,z as j,o as m,c as f,n as p,a as c,A as S,B as C,t as V,F as E,v as N,d as J,_ as b,x as B,b as g,w as x,m as K,C as W,l as H,D as z,E as q}from"./BMlppDSU.js";import"./et_7OtE1.js";const G=[{id:"white",name:"Белый"},{id:"black",name:"Черный"},{id:"blue",name:"Синий"},{id:"red",name:"Красный"},{id:"green",name:"Зеленый"},{id:"yellow",name:"Желтый"}],Q=["aria-expanded"],X=["aria-selected","onClick","onKeydown"],Y=$({__name:"Dropdown",props:{items:{},currentItem:{default:""},externalInvalid:{type:Boolean,default:!1}},emits:["inputEvent","changeItem","validation"],setup(d,{emit:s}){const n=d,r=k(!1),i=k(n.currentItem),u=s;U(()=>n.currentItem,e=>{i.value=e});const y=w(()=>{const e=n.items.find(o=>o.id===i.value);return e?e.name:"Select"}),_=w(()=>i.value),h=()=>{r.value=!r.value},l=()=>{r.value=!1},a=e=>{i.value=e.id,u("inputEvent",e.id),u("changeItem",e.id),l()},t={mounted(e,o){const v=I=>{e===I.target||e.contains(I.target)||o.value(I)};e.clickOutsideHandler=v,document.body.addEventListener("click",v)},unmounted(e){const o=e.clickOutsideHandler;o&&document.body.removeEventListener("click",o)}};return(e,o)=>j((m(),f("div",{class:p(e.$style.wrap)},[c("button",{class:p([e.$style.dropdown,n.externalInvalid?e.$style.error:""]),onClick:h,onKeydown:C(l,["esc"]),"aria-haspopup":"listbox","aria-expanded":r.value},[c("span",null,V(y.value),1),(m(),f("svg",{class:p(r.value?[e.$style.chevron,e.$style.rotated]:e.$style.chevron),width:"16",height:"16",viewBox:"0 0 16 16"},[...o[0]||(o[0]=[c("path",{d:"M4 6L8 10L12 6",stroke:"currentColor",fill:"none"},null,-1)])],2))],42,Q),r.value?(m(),f("div",{key:0,class:p(e.$style.menu),role:"listbox","aria-labelledby":"dropdown-label"},[(m(!0),f(E,null,N(d.items,(v,I)=>(m(),f("div",{key:I,role:"option","aria-selected":v.id===_.value,class:p(v.id===_.value?[e.$style.option,e.$style["is-selected"]]:e.$style.option),onClick:D=>a(v),onKeydown:[C(D=>a(v),["enter"]),C(D=>a(v),["space"])],tabindex:"0"},[c("span",{class:p(e.$style["option-content"])},[J(V(v.name)+" ",1),v.id===_.value?(m(),f("svg",{key:0,class:p(e.$style.checkmark),width:"16",height:"16",viewBox:"0 0 16 16",fill:"none"},[...o[1]||(o[1]=[c("path",{d:"M13.3334 4L6.00008 11.3333L2.66675 8",stroke:"#ff8800","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])],2)):S("",!0)],2)],42,X))),128))],2)):S("",!0)],2)),[[t,l]])}}),Z="_wrap_1c0xe_1",ee="_dropdown_1c0xe_9",te="_chevron_1c0xe_33",ne="_rotated_1c0xe_38",oe="_menu_1c0xe_42",ae="_checkmark_1c0xe_64",le="_option_1c0xe_57",se="_error_1c0xe_82",re={wrap:Z,dropdown:ee,chevron:te,rotated:ne,menu:oe,"option-content":"_option-content_1c0xe_57",checkmark:ae,option:le,error:se,"is-selected":"_is-selected_1c0xe_87"},ie={$style:re},ce=b(Y,[["__cssModules",ie]]),ue=["value","placeholder"],de=$({__name:"Input",props:{modelValue:{type:[String,Number],default:""},type:{type:String,validator:d=>["count","price"].includes(d),default:"count"},externalInvalid:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(d,{emit:s}){const n=d,r=s,i=k(null),u=w(()=>!n.modelValue&&n.modelValue!==0&&n.modelValue!=="0"?"":String(n.modelValue)),y=w(()=>n.type==="count"?"0":"0.00"),_=l=>{let t=l.target.value;if(t=t.replace(/[^\d.]/g,""),(t.match(/\./g)||[]).length>1){const o=t.indexOf(".");t=t.substring(0,o+1)+t.substring(o+1).replace(/\./g,"")}if(t.includes(".")){const o=t.split(".");o[1]&&o[1].length>2&&(t=o[0]+"."+o[1].substring(0,2))}r("update:modelValue",t),B(()=>{i.value&&(i.value.value=t)})},h=()=>{r("update:modelValue",""),B(()=>{i.value&&i.value.focus()})};return(l,a)=>(m(),f("div",{class:p([l.$style.customInputWrapper,n.externalInvalid?l.$style.invalid:""])},[c("input",{ref_key:"inputRef",ref:i,type:"text",class:p(l.$style.customInput),value:u.value,placeholder:y.value,onInput:_},null,42,ue),u.value?(m(),f("button",{key:0,class:p(l.$style.clearButton),onClick:h,type:"button"},[...a[0]||(a[0]=[c("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none"},[c("path",{d:"M15 1L1 15M1 1L15 15",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1)])],2)):S("",!0)],2))}}),pe="_customInputWrapper_1lnk0_1",me="_invalid_1lnk0_19",ve="_customInput_1lnk0_1",fe="_clearButton_1lnk0_42",_e={customInputWrapper:pe,invalid:me,customInput:ve,clearButton:fe},ye={$style:_e},M=b(de,[["__cssModules",ye]]),he=$({__name:"TableData",props:{products:{},validationErrors:{default:()=>[]}},emits:["update:products"],setup(d,{emit:s}){const n=d,r=s,i=k({}),u=(l,a)=>n.validationErrors.some(t=>t.productId===l&&t.field===a),y=(l,a)=>{a===""||a==="."?delete i.value[l]:i.value[l]=a;const t=n.products.map(e=>e.id===l?a===""||a==="."?{...e,count:null}:a.includes(".")?{...e,count:NaN}:{...e,count:parseInt(a)||0}:e);r("update:products",t)},_=(l,a)=>{const t=n.products.map(e=>e.id===l?{...e,price:a===""?null:parseFloat(a)||0}:e);r("update:products",t)},h=(l,a)=>{const t=n.products.map(e=>e.id===l?{...e,color:a}:e);r("update:products",t)};return(l,a)=>{const t=A;return m(),f("table",{class:p([l.common.table,l.local.table])},[a[0]||(a[0]=c("thead",null,[c("tr",null,[c("th",null,"Название"),c("th",null,"Количество"),c("th",null,"Цена"),c("th",null,"Цвет")])],-1)),c("tbody",null,[(m(!0),f(E,null,N(d.products,e=>(m(),f("tr",{key:e.id},[c("td",null,V(e.name),1),c("td",null,[g(M,{modelValue:i.value[e.id]!==void 0?i.value[e.id]:e.count===null||e.count===0||isNaN(e.count)?"":e.count.toString(),"onUpdate:modelValue":o=>y(e.id,o),type:"count",externalInvalid:u(e.id,"count")},null,8,["modelValue","onUpdate:modelValue","externalInvalid"])]),c("td",null,[g(M,{modelValue:e.price===null||e.price===0?"":e.price.toString(),"onUpdate:modelValue":o=>_(e.id,o),type:"price",externalInvalid:u(e.id,"price")},null,8,["modelValue","onUpdate:modelValue","externalInvalid"])]),c("td",null,[g(t,null,{default:x(()=>[g(ce,{items:K(G),currentItem:e.color,onChangeItem:o=>h(e.id,o),externalInvalid:u(e.id,"color")},null,8,["items","currentItem","onChangeItem","externalInvalid"])]),_:2},1024)])]))),128))])],2)}}}),ge="_table_d4k9s_1",Ie={table:ge},ke={common:O,local:Ie},$e=Object.assign(b(he,[["__cssModules",ke]]),{__name:"ContentTableContainerTableData"}),be=$({__name:"SaveButton",props:{onClick:{type:Function}},setup(d){const s=d;return(n,r)=>(m(),f("button",{class:p(n.$style.btnSave),onClick:r[0]||(r[0]=(...i)=>s.onClick&&s.onClick(...i))},"Сохранить",2))}}),we="_btnSave_3cr6r_1",Ce={btnSave:we},Se={$style:Ce},Ve=b(be,[["__cssModules",Se]]);function xe(d){const s=[];return d.forEach(n=>{n.count===null||n.count===void 0||n.count===0||isNaN(n.count)?s.push({productId:n.id,field:"count"}):typeof n.count=="number"&&n.count%1!==0&&s.push({productId:n.id,field:"count"}),(n.price===null||n.price===void 0||n.price===0)&&s.push({productId:n.id,field:"price"}),(!n.color||n.color==="Select"||n.color==="")&&s.push({productId:n.id,field:"color"})}),{isValid:s.length===0,errors:s}}const De=$({__name:"dataView",props:{id:{}},setup(d){const s=d,n=q(),r=L(),i=k([]),u=k([]),{updatePresendStorage:y}=F(),_=async()=>{if(typeof window<"u"){const t=localStorage.getItem(`application_${s.id}`);if(t)try{const e=JSON.parse(t);if(Array.isArray(e)&&e.length>0){u.value=e;return}}catch(e){console.error("Error parsing stored data:",e)}}const a=r.getCurrentApplication()?.productsID||[];if(a.length===0){u.value=[];return}try{let t=[];try{const{data:o}=await P("/api/products",{key:`products-${s.id}`,default:()=>[],server:!1},"$r0gqiC4M95");t=o.value||[]}catch(o){console.log("API failed, trying static JSON...",o);const v=z();t=await $fetch(`${v.public.baseURL||""}/api/products.json`)}const e=t.filter(o=>a.includes(o.id)).map(o=>({id:o.id,name:o.name,price:o.price,count:o.count,color:o.color}));u.value=e,typeof window<"u"&&localStorage.setItem(`application_${s.id}`,JSON.stringify(e))}catch(t){console.error("All data loading methods failed:",t),u.value=[]}r.clearCurrentApplication()};W(()=>{_()});const h=()=>{const l=xe(u.value);if(i.value=l.errors,typeof window<"u"&&localStorage.setItem(`application_${s.id}`,JSON.stringify(u.value)),l.isValid){const a=r.getCurrentApplication(),t={id:parseInt(s.id),isPublished:!0,products:u.value,status:a?.status??"draft",createdAt:a?.createdAt??new Date().toISOString()};y(t);try{localStorage.removeItem(`application_${s.id}`)}catch(e){console.error("Error removing localStorage item:",e)}n.push("/")}};return(l,a)=>{const t=T;return m(),H(t,null,{default:x(()=>[c("div",{class:p(l.$style.tabContainer)},[g(Ve,{onClick:h})],2),g(R,null,{default:x(()=>[g($e,{products:u.value,"onUpdate:products":a[0]||(a[0]=e=>u.value=e),validationErrors:i.value},null,8,["products","validationErrors"])]),_:1})]),_:1})}}}),Be="_tabContainer_n1ij4_1",Me={tabContainer:Be},Ee={$style:Me},Le=b(De,[["__cssModules",Ee]]);export{Le as default};
