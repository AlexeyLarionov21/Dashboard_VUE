import{u as B,a as P,_ as M,b as R,s as j,c as D,T as F}from"./yVxLFZCV.js";import{g as b,c as i,o,n as u,r as z,d as L,t as d,_ as y,p as N,q as V,s as O,k as Q,a as e,l as v,m as $,w as f,F as q,v as E,b as _,x as G}from"./BlA8TAHk.js";import"./1JzQDLua.js";const U=b({__name:"label",props:{variant:{default:"draft"}},setup(a){const n={draft:"Активна"};return(s,r)=>(o(),i("span",{class:u([s.$style.label,s.$style[a.variant]])},[z(s.$slots,"default",{},()=>[L(d(n[a.variant]),1)])],2))}}),Y="_label_xgtno_1",H="_draft_xgtno_15",I="_sent_xgtno_20",J={label:Y,draft:H,sent:I},K={$style:J},W=y(U,[["__cssModules",K]]),X=b({__name:"Button",props:{label:{},variant:{default:"edit"},isSend:{type:Boolean},onClick:{}},setup(a){return(n,s)=>(o(),i("button",{class:u([n.$style.button,n.$style[a.variant]]),onClick:s[0]||(s[0]=r=>a.onClick?.())},d(a.label),3))}}),Z="_button_116bj_1",tt="_edit_116bj_13",et="_presend_116bj_22",nt={button:Z,edit:tt,presend:et},st={$style:nt},at=y(X,[["__cssModules",st]]),lt={key:0},ot=b({__name:"Table",async setup(a){let n,s;const{getPresendApplications:r,removeFromPresend:C}=P(),k=N(),g=B(),{data:m,pending:x,refresh:_t}=([n,s]=V(()=>R("/api/table-data",{default:()=>[]},"$7G96YdQnvQ")),n=await n,s(),n),h=O(r()),A=Q(()=>m.value.map(t=>h.value[t.id]?{...t,isPublished:!0}:t)),w=async t=>{t.isPublished?(await S(t),console.log("отправка заявки",t.id)):(g.setCurrentApplication(t),await G(),await k.push(`/edit?id=${t.id}`))},S=async t=>{try{const l=await $fetch("/api/send",{method:"POST"});C(t.id),h.value=r(),alert("Заявка отправлена"),m.value=(m.value||[]).filter(p=>p.id!==t.id)}catch(l){alert("ошибка"),console.error("ошибка отправки",l)}},T=t=>new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});return(t,l)=>{const p=M;return o(),i("table",{class:u([t.common.table,t.local.table])},[l[1]||(l[1]=e("thead",null,[e("tr",null,[e("th",null,"Номер"),e("th",null,"Статус"),e("th",null,"Результат"),e("th",null,"Дата"),e("th",null,"Действие")])],-1)),e("tbody",null,[$(x)?(o(),i("tr",lt,[...l[0]||(l[0]=[e("td",{colspan:"5"},[e("h3",null,"Загрузка..")],-1)])])):(o(),v(p,{key:1},{default:f(()=>[(o(!0),i(q,null,E($(A),c=>(o(),i("tr",{key:c.id},[e("td",null,d(c.id),1),e("td",null,[_(W,{variant:"draft"})]),e("td",{class:u(t.local.tdResult)},"В обработке",2),e("td",null,d(T(c.createdAt)),1),e("td",null,[_(at,{variant:c.isPublished?"presend":"edit",label:c.isPublished?"Отправить":"Редактировать",onClick:()=>w(c)},null,8,["variant","label","onClick"])])]))),128))]),_:1}))])],2)}}}),rt="_tdResult_izthi_1",ct="_table_izthi_5",it={tdResult:rt,table:ct},ut={common:j,local:it},dt=Object.assign(y(ot,[["__cssModules",ut]]),{__name:"ContentTableContainerTable"}),ft=b({__name:"index",setup(a){return(n,s)=>{const r=D;return o(),v(r,null,{default:f(()=>[_(F,null,{default:f(()=>[_(dt)]),_:1})]),_:1})}}});export{ft as default};
