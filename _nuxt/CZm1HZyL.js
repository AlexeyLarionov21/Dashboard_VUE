import{c as O,s as L,u as T,b as A,_ as P,T as F,a as R}from"./D8AgtSry.js";import{g as $,s as I,y as U,k as w,z as K,o as m,c as v,n as p,a as c,A as S,B as C,t as V,F as N,v as E,d as W,_ as b,x as D,b as g,w as x,m as j,C as H,l as J,D as z}from"./r7Uw9dmx.js";import"./2NT90EHJ.js";const q=[{id:"white",name:"Белый"},{id:"black",name:"Черный"},{id:"blue",name:"Синий"},{id:"red",name:"Красный"},{id:"green",name:"Зеленый"},{id:"yellow",name:"Желтый"}],G=["aria-expanded"],Q=["aria-selected","onClick","onKeydown"],X=$({__name:"Dropdown",props:{items:{},currentItem:{default:""},externalInvalid:{type:Boolean,default:!1}},emits:["inputEvent","changeItem","validation"],setup(d,{emit:s}){const t=d,i=I(!1),r=I(t.currentItem),u=s;U(()=>t.currentItem,e=>{r.value=e});const h=w(()=>{const e=t.items.find(a=>a.id===r.value);return e?e.name:"Select"}),y=w(()=>r.value),_=()=>{i.value=!i.value},n=()=>{i.value=!1},o=e=>{r.value=e.id,u("inputEvent",e.id),u("changeItem",e.id),n()},l={mounted(e,a){const f=k=>{e===k.target||e.contains(k.target)||a.value(k)};e.clickOutsideHandler=f,document.body.addEventListener("click",f)},unmounted(e){const a=e.clickOutsideHandler;a&&document.body.removeEventListener("click",a)}};return(e,a)=>K((m(),v("div",{class:p(e.$style.wrap)},[c("button",{class:p([e.$style.dropdown,t.externalInvalid?e.$style.error:""]),onClick:_,onKeydown:C(n,["esc"]),"aria-haspopup":"listbox","aria-expanded":i.value},[c("span",null,V(h.value),1),(m(),v("svg",{class:p(i.value?[e.$style.chevron,e.$style.rotated]:e.$style.chevron),width:"16",height:"16",viewBox:"0 0 16 16"},[...a[0]||(a[0]=[c("path",{d:"M4 6L8 10L12 6",stroke:"currentColor",fill:"none"},null,-1)])],2))],42,G),i.value?(m(),v("div",{key:0,class:p(e.$style.menu),role:"listbox","aria-labelledby":"dropdown-label"},[(m(!0),v(N,null,E(d.items,(f,k)=>(m(),v("div",{key:k,role:"option","aria-selected":f.id===y.value,class:p(f.id===y.value?[e.$style.option,e.$style["is-selected"]]:e.$style.option),onClick:B=>o(f),onKeydown:[C(B=>o(f),["enter"]),C(B=>o(f),["space"])],tabindex:"0"},[c("span",{class:p(e.$style["option-content"])},[W(V(f.name)+" ",1),f.id===y.value?(m(),v("svg",{key:0,class:p(e.$style.checkmark),width:"16",height:"16",viewBox:"0 0 16 16",fill:"none"},[...a[1]||(a[1]=[c("path",{d:"M13.3334 4L6.00008 11.3333L2.66675 8",stroke:"#ff8800","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])],2)):S("",!0)],2)],42,Q))),128))],2)):S("",!0)],2)),[[l,n]])}}),Y="_wrap_1c0xe_1",Z="_dropdown_1c0xe_9",ee="_chevron_1c0xe_33",te="_rotated_1c0xe_38",ne="_menu_1c0xe_42",oe="_checkmark_1c0xe_64",le="_option_1c0xe_57",ae="_error_1c0xe_82",se={wrap:Y,dropdown:Z,chevron:ee,rotated:te,menu:ne,"option-content":"_option-content_1c0xe_57",checkmark:oe,option:le,error:ae,"is-selected":"_is-selected_1c0xe_87"},ie={$style:se},re=b(X,[["__cssModules",ie]]),ce=["value","placeholder"],ue=$({__name:"Input",props:{modelValue:{type:[String,Number],default:""},type:{type:String,validator:d=>["count","price"].includes(d),default:"count"},externalInvalid:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(d,{emit:s}){const t=d,i=s,r=I(null),u=w(()=>!t.modelValue&&t.modelValue!==0&&t.modelValue!=="0"?"":String(t.modelValue)),h=w(()=>t.type==="count"?"0":"0.00"),y=n=>{let l=n.target.value;if(l=l.replace(/[^\d.]/g,""),(l.match(/\./g)||[]).length>1){const a=l.indexOf(".");l=l.substring(0,a+1)+l.substring(a+1).replace(/\./g,"")}if(l.includes(".")){const a=l.split(".");a[1]&&a[1].length>2&&(l=a[0]+"."+a[1].substring(0,2))}i("update:modelValue",l),D(()=>{r.value&&(r.value.value=l)})},_=()=>{i("update:modelValue",""),D(()=>{r.value&&r.value.focus()})};return(n,o)=>(m(),v("div",{class:p([n.$style.customInputWrapper,t.externalInvalid?n.$style.invalid:""])},[c("input",{ref_key:"inputRef",ref:r,type:"text",class:p(n.$style.customInput),value:u.value,placeholder:h.value,onInput:y},null,42,ce),u.value?(m(),v("button",{key:0,class:p(n.$style.clearButton),onClick:_,type:"button"},[...o[0]||(o[0]=[c("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none"},[c("path",{d:"M15 1L1 15M1 1L15 15",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1)])],2)):S("",!0)],2))}}),de="_customInputWrapper_1lnk0_1",pe="_invalid_1lnk0_19",me="_customInput_1lnk0_1",ve="_clearButton_1lnk0_42",_e={customInputWrapper:de,invalid:pe,customInput:me,clearButton:ve},fe={$style:_e},M=b(ue,[["__cssModules",fe]]),ye=$({__name:"TableData",props:{products:{},validationErrors:{default:()=>[]}},emits:["update:products"],setup(d,{emit:s}){const t=d,i=s,r=I({}),u=(n,o)=>t.validationErrors.some(l=>l.productId===n&&l.field===o),h=(n,o)=>{o===""||o==="."?delete r.value[n]:r.value[n]=o;const l=t.products.map(e=>e.id===n?o===""||o==="."?{...e,count:null}:o.includes(".")?{...e,count:NaN}:{...e,count:parseInt(o)||0}:e);i("update:products",l)},y=(n,o)=>{const l=t.products.map(e=>e.id===n?{...e,price:o===""?null:parseFloat(o)||0}:e);i("update:products",l)},_=(n,o)=>{const l=t.products.map(e=>e.id===n?{...e,color:o}:e);i("update:products",l)};return(n,o)=>{const l=O;return m(),v("table",{class:p([n.common.table,n.local.table])},[o[0]||(o[0]=c("thead",null,[c("tr",null,[c("th",null,"Название"),c("th",null,"Количество"),c("th",null,"Цена"),c("th",null,"Цвет")])],-1)),c("tbody",null,[(m(!0),v(N,null,E(d.products,e=>(m(),v("tr",{key:e.id},[c("td",null,V(e.name),1),c("td",null,[g(M,{modelValue:r.value[e.id]!==void 0?r.value[e.id]:e.count===null||e.count===0||isNaN(e.count)?"":e.count.toString(),"onUpdate:modelValue":a=>h(e.id,a),type:"count",externalInvalid:u(e.id,"count")},null,8,["modelValue","onUpdate:modelValue","externalInvalid"])]),c("td",null,[g(M,{modelValue:e.price===null||e.price===0?"":e.price.toString(),"onUpdate:modelValue":a=>y(e.id,a),type:"price",externalInvalid:u(e.id,"price")},null,8,["modelValue","onUpdate:modelValue","externalInvalid"])]),c("td",null,[g(l,null,{default:x(()=>[g(re,{items:j(q),currentItem:e.color,onChangeItem:a=>_(e.id,a),externalInvalid:u(e.id,"color")},null,8,["items","currentItem","onChangeItem","externalInvalid"])]),_:2},1024)])]))),128))])],2)}}}),he="_table_d4k9s_1",ge={table:he},Ie={common:L,local:ge},ke=Object.assign(b(ye,[["__cssModules",Ie]]),{__name:"ContentTableContainerTableData"}),$e=$({__name:"SaveButton",props:{onClick:{type:Function}},setup(d){const s=d;return(t,i)=>(m(),v("button",{class:p(t.$style.btnSave),onClick:i[0]||(i[0]=(...r)=>s.onClick&&s.onClick(...r))},"Сохранить",2))}}),be="_btnSave_3cr6r_1",we={btnSave:be},Ce={$style:we},Se=b($e,[["__cssModules",Ce]]);function Ve(d){const s=[];return d.forEach(t=>{t.count===null||t.count===void 0||t.count===0||isNaN(t.count)?s.push({productId:t.id,field:"count"}):typeof t.count=="number"&&t.count%1!==0&&s.push({productId:t.id,field:"count"}),(t.price===null||t.price===void 0||t.price===0)&&s.push({productId:t.id,field:"price"}),(!t.color||t.color==="Select"||t.color==="")&&s.push({productId:t.id,field:"color"})}),{isValid:s.length===0,errors:s}}const xe=$({__name:"dataView",props:{id:{}},setup(d){const s=d,t=z(),i=T(),r=I([]),u=I([]),{updatePresendStorage:h}=R();H(async()=>{if(typeof window<"u"){const e=localStorage.getItem(`application_${s.id}`);if(e){u.value=JSON.parse(e);return}}const n=i.getCurrentApplication()?.productsID||[];if(n.length===0){u.value=[];return}const{data:o}=await A("/api/products",{key:`products-${s.id}`,default:()=>[]},"$r0gqiC4M95"),l=o.value.filter(e=>n.includes(e.id)).map(e=>({id:e.id,name:e.name,price:e.price,count:e.count,color:e.color}));u.value=l,typeof window<"u"&&localStorage.setItem(`application_${s.id}`,JSON.stringify(l)),i.clearCurrentApplication()});const y=()=>{const _=Ve(u.value);if(r.value=_.errors,typeof window<"u"&&localStorage.setItem(`application_${s.id}`,JSON.stringify(u.value)),_.isValid){const n=i.getCurrentApplication(),o={id:parseInt(s.id),isPublished:!0,products:u.value,status:n?.status??"draft",createdAt:n?.createdAt??new Date().toISOString()};h(o);try{localStorage.removeItem(`application_${s.id}`)}catch{}t.push("/")}};return(_,n)=>{const o=P;return m(),J(o,null,{default:x(()=>[c("div",{class:p(_.$style.tabContainer)},[g(Se,{onClick:y})],2),g(F,null,{default:x(()=>[g(ke,{products:u.value,"onUpdate:products":n[0]||(n[0]=l=>u.value=l),validationErrors:r.value},null,8,["products","validationErrors"])]),_:1})]),_:1})}}}),Be="_tabContainer_n1ij4_1",De={tabContainer:Be},Me={$style:De},Le=b(xe,[["__cssModules",Me]]);export{Le as default};
